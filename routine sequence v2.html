<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CAF Drill Routine Simulator - v17</title>
    <style>
        :root {
            --air-color: #5d9cec; --army-color: #4a6741; --navy-color: #2c3e50;
            --cmd-color: #d9534f; --base-speed: 600ms;
        }
        body { font-family: 'Segoe UI', sans-serif; display: flex; background: #e9ecef; margin: 0; height: 100vh; overflow: hidden; }
        .is-marker .circle { border: 4px solid #ffdb58 !important; box-shadow: 0 0 15px #ffdb58 !important; }
        .is-pivot .circle { border: 4px solid #2ecc71 !important; box-shadow: 0 0 20px #2ecc71 !important; z-index: 50; }
        
        #sidebar { width: 380px; background: #fff; border-right: 2px solid #ccc; padding: 20px; display: flex; flex-direction: column; overflow-y: auto; box-sizing: border-box; }
        .move-item { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 6px; border: 1px solid #ddd; position: relative; }
        .move-item.active { border-left: 5px solid #2e7d32; background: #e8f5e9; }
        
        #main { flex-grow: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; position: relative; overflow: auto; }
        .controls { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; gap: 15px; align-items: center; z-index: 100; }
        
        #grid-floor { 
            position: relative; background: #fff; border: 2px solid #333;
            background-image: linear-gradient(#ddd 1px, transparent 1px), linear-gradient(90deg, #ddd 1px, transparent 1px);
            background-size: 40px 40px; min-width: 2500px; min-height: 2500px;
        }

        .member { 
            position: absolute; width: 40px; height: 40px; 
            transition: all var(--anim-speed, 600ms) linear;
            display: flex; align-items: center; justify-content: center; z-index: 10;
        }
        .circle { width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 11px; position: relative; }
        
        .army { background: var(--army-color); } .air { background: var(--air-color); } .navy { background: var(--navy-color); }
        .commander { background: var(--cmd-color); border: 2px solid #fff; }
        
        button { cursor: pointer; padding: 8px 12px; border-radius: 4px; border: none; font-weight: bold; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .slider-container { background: #f1f3f5; padding: 12px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #dee2e6; }
    </style>
</head>
<body>

<div id="sidebar">
    <h3 style="margin:0;">CAF Engine v17</h3>
    <p id="mode-display" style="font-size: 12px; font-weight:bold; color: #d35400; margin-bottom: 15px;">Mode: In Line</p>

    <div class="slider-container">
        <label style="font-size: 12px; font-weight: bold; display: flex; justify-content: space-between;">
            Playback Speed <span id="speed-val">1.0x</span>
        </label>
        <input type="range" id="speed-slider" min="0.2" max="3" step="0.1" value="1" oninput="updateTempo(this.value)">
    </div>
    
    <div id="move-list"></div>

    <div style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: auto;">
        <div class="btn-group">
            <button style="background:#2e7d32; color:white;" onclick="runSequence()">START</button>
            <button style="background:#c62828; color:white;" onclick="stopSequence()">HALT</button>
        </div>
        <div class="btn-group">
            <button style="background:#546e7a; color:white;" onclick="initSim()">RESET</button>
            <button style="background:#78909c; color:white;" onclick="clearRoutine()">CLEAR</button>
        </div>
        <div id="status-display" style="font-size:11px; font-weight:bold;">State: Closed Order</div>
        <div class="btn-group" style="margin-top:10px">
            <button onclick="saveRoutine()" style="background:#333; color:white;">SAVE</button>
            <button onclick="document.getElementById('upload-input').click()" style="background:#333; color:white;">LOAD</button>
        </div>
        <input type="file" id="upload-input" style="display:none" onchange="loadRoutine(event)">
    </div>
</div>

<div id="main">
    <div class="controls">
        <select id="element"><option value="army">Army</option><option value="air">Air Force</option><option value="navy">Navy</option></select>
        <label>Count: <input type="number" id="count" value="12" style="width:45px"></label>
        <label><input type="checkbox" id="showCmdr" checked> Cmdr</label>
        <button onclick="initSim()" style="background:#333; color:white;">APPLY</button>
    </div>
    <div id="grid-floor"></div>
</div>

<script src="drill-engine.js"></script>
</body>
</html>