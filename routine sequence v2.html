<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CAF Drill Routine Simulator - v17</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="sidebar">
    <h3 style="margin:0;">CAF Engine v17</h3>
    <p id="mode-display" style="font-size: 12px; font-weight:bold; color: #d35400; margin-bottom: 15px;">Mode: In Line</p>

    <div class="slider-container">
        <label style="font-size: 12px; font-weight: bold; display: flex; justify-content: space-between;">
            Playback Speed <span id="speed-val">1.0x</span>
        </label>
        <input type="range" id="speed-slider" min="0.2" max="3" step="0.1" value="1" oninput="updateTempo(this.value)">
    </div>
    
    <div id="move-list"></div>

    <button onclick="addNewStepManual()" style="width:100%; padding: 8px; margin-bottom: 15px; background:#455a64; color:white; border:none; border-radius:4px; cursor:pointer; font-size:11px; font-weight:bold;">+ ADD MOVE</button>

    <div style="border-top: 1px solid #ddd; padding-top: 15px; margin-top: auto;">
        <div class="btn-group">
            <button style="background:#2e7d32; color:white;" onclick="runSequence()">START</button>
            <button style="background:#c62828; color:white;" onclick="stopSequence()">HALT</button>
        </div>
        <div class="btn-group">
            <button style="background:#546e7a; color:white;" onclick="initSim()">RESET</button>
            <button style="background:#78909c; color:white;" onclick="clearRoutine()">CLEAR</button>
        </div>
        <div id="status-display" style="font-size:11px; font-weight:bold;">State: Closed Order</div>
        <div class="btn-group" style="margin-top:10px">
            <button onclick="saveRoutine()" style="background:#333; color:white;">SAVE</button>
            <button onclick="document.getElementById('upload-input').click()" style="background:#333; color:white;">LOAD</button>
        </div>
        <input type="file" id="upload-input" style="display:none" onchange="loadRoutine(event)">
    </div>
</div>

<div id="main">
    <div class="controls">
        <select id="element"><option value="army">Army</option><option value="air">Air Force</option><option value="navy">Navy</option></select>
        <label>Count: <input type="number" id="count" value="18" style="width:45px"></label>
        <label><input type="checkbox" id="showCmdr" checked> Cmdr</label>
        <button onclick="initSim()" style="background:#333; color:white;">APPLY</button>
    </div>
    <div id="grid-floor"></div>
</div>

<script src="drill-engine.js"></script>
<script>
    // Integration helper for manual step addition
    function addNewStepManual() {
        const list = document.getElementById('move-list');
        const currentCount = list.querySelectorAll('.move-item').length;
        // Calls the existing createRow function from drill-engine.js
        list.appendChild(createRow(currentCount + 1));
    }
</script>
</body>
</html>