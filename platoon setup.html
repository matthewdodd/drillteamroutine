<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Platoon Setup</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      display: flex;
      flex-direction: row;
      gap: 40px;
    }

    .input-section {
      max-width: 220px;
    }

    .platoon-sizes {
      margin-bottom: 20px;
    }

    .platoon-size-input {
      margin-bottom: 8px;
    }

    .main-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .pc-leader {
      width: 40px;
      height: 40px;
      background-color: silver;
      border-radius: 50%;
      color: black;
      font-weight: bold;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      user-select: none;
    }

    .grids-wrapper {
      display: flex;
      gap: 40px;
      flex-wrap: nowrap;
    }

    .grid-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .grid {
      display: grid;
      gap: 5px;
    }

    .circle {
      width: 30px;
      height: 30px;
      background-color: blue;
      border-radius: 50%;
      color: white;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .commander {
      width: 30px;
      height: 30px;
      background-color: gold;
      border-radius: 50%;
      color: black;
      font-weight: bold;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }

    .placeholder {
      width: 32px;
      height: 32px;
      background-color: transparent;
    }

    /* Legend styling */
    .legend {
      margin-top: 20px;
      font-size: 14px;
      line-height: 1.5;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      user-select: none;
    }
    .legend-circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    .legend-commander {
      background-color: gold;
      color: black;
    }
    .legend-pc {
      background-color: silver;
      color: black;
    }
  </style>
</head>
<body>

  <div class="input-section">
    <h2>Platoon Setup</h2>

    <label for="numGrids">How many Platoons? (1–3):</label><br />
    <input type="number" id="numGrids" min="1" max="3" value="1" /><br /><br />

    <div class="platoon-sizes" id="platoonSizesContainer">
      <!-- Individual platoon size inputs will appear here -->
    </div>

    <label>
      <input type="checkbox" id="commanderCheck" />
      Is there a commander?
    </label><br /><br />

    <button onclick="generateGrids()">Generate</button>


  <div class="legend">
    <div class="legend-item">
      <div class="legend-circle legend-commander">C</div>
      <span>= Platoon Commander</span>
    </div>
    <div class="legend-item">
      <div class="legend-circle legend-pc">PC</div>
      <span>= Parade Commander</span>
    </div>
  </div>
</div>

  <div class="main-content" id="mainContent">
    <!-- PC circle will appear here if multiple grids -->
    <div id="pcLeaderContainer"></div>

    <div class="grids-wrapper" id="gridsWrapper">
      <!-- Multiple grids will be inserted here -->
    </div>
  </div>

  <script>
    const platoonSizesContainer = document.getElementById('platoonSizesContainer');
    const numGridsInput = document.getElementById('numGrids');
    const pcLeaderContainer = document.getElementById('pcLeaderContainer');

    // Initialize inputs for platoon sizes
    function updatePlatoonSizeInputs() {
      const numGrids = parseInt(numGridsInput.value) || 1;
      platoonSizesContainer.innerHTML = '';

      for (let i = 0; i < numGrids; i++) {
        const div = document.createElement('div');
        div.classList.add('platoon-size-input');

        const label = document.createElement('label');
        label.textContent = `How many in Platoon ${i + 1}? (1–40): `;
        label.setAttribute('for', `platoonSize${i}`);

        const input = document.createElement('input');
        input.type = 'number';
        input.id = `platoonSize${i}`;
        input.min = 1;
        input.max = 40;
        input.value = 10;

        div.appendChild(label);
        div.appendChild(document.createElement('br'));
        div.appendChild(input);

        platoonSizesContainer.appendChild(div);
      }
    }

    // Call once on load to set initial inputs
    updatePlatoonSizeInputs();

    // Update inputs when numGrids changes
    numGridsInput.addEventListener('input', () => {
      let val = parseInt(numGridsInput.value);
      if (isNaN(val) || val < 1) {
        numGridsInput.value = 1;
      } else if (val > 3) {
        numGridsInput.value = 3;
      }
      updatePlatoonSizeInputs();
    });

    function generateGrid(input, hasCommander) {
      let rows, cols;
      if (input <= 5) {
        rows = 1;
        cols = 5;
      } else if (input <= 10) {
        rows = 2;
        cols = Math.ceil(input / 2);
      } else {
        rows = 3;
        cols = Math.ceil(input / 3);
      }

      const gridWrapper = document.createElement('div');
      gridWrapper.classList.add('grid-wrapper');

      // Commander circle container
      const commanderDiv = document.createElement('div');
      if (hasCommander) {
        const commanderCircle = document.createElement('div');
        commanderCircle.classList.add('commander');
        commanderCircle.textContent = 'C';
        commanderDiv.appendChild(commanderCircle);
      }
      gridWrapper.appendChild(commanderDiv);

      // Grid container
      const grid = document.createElement('div');
      grid.classList.add('grid');
      grid.style.gridTemplateColumns = `repeat(${cols}, 32px)`;

      const totalCells = rows * cols;
      const cells = Array(totalCells).fill(null);
      const remainder = input % 3;

      function adjustedIndex(row, col, cols) {
        return row * cols + (cols - 1 - col);
      }

      cells.fill(null);

      if ((remainder === 1 && input > 5 && input < 11) || input === 9) {
        if (input === 10) {
          // no placeholder for 10 here
        } else { 
          cells[adjustedIndex(1, 1, cols)] = 'placeholder'; 
        }
      } else if (remainder === 1 && input > 10) {
        cells[adjustedIndex(1, 1, cols)] = 'placeholder';
        cells[adjustedIndex(2, 1, cols)] = 'placeholder';
      } else if (remainder === 2 && input > 10) {
        cells[adjustedIndex(1, 1, cols)] = 'placeholder';
      }

      let count = 1;
      for (let r = 0; r < rows; r++) {
        for (let c = cols - 1; c >= 0; c--) {
          const idx = r * cols + c;
          if (cells[idx] === 'placeholder') {
            const blank = document.createElement('div');
            blank.classList.add('placeholder');
            grid.appendChild(blank);
          } else if (count <= input) {
            const circle = document.createElement('div');
            circle.classList.add('circle');
            circle.textContent = count++;
            grid.appendChild(circle);
          } else {
            const blank = document.createElement('div');
            blank.classList.add('placeholder');
            grid.appendChild(blank);
          }
        }
      }

      gridWrapper.appendChild(grid);
      return gridWrapper;
    }

    function generateGrids() {
      const numGrids = parseInt(numGridsInput.value);
      const hasCommander = document.getElementById('commanderCheck').checked;
      const gridsWrapper = document.getElementById('gridsWrapper');

      gridsWrapper.innerHTML = '';
      pcLeaderContainer.innerHTML = '';

      // If more than one grid, add PC circle above all
      if (numGrids > 1) {
        const pcCircle = document.createElement('div');
        pcCircle.classList.add('pc-leader');
        pcCircle.textContent = 'PC';
        pcLeaderContainer.appendChild(pcCircle);
      }

      for (let i = 0; i < numGrids; i++) {
        const platoonSizeInput = document.getElementById(`platoonSize${i}`);
        const input = parseInt(platoonSizeInput.value);

        if (isNaN(input) || input < 1 || input > 40) {
          alert(`Please enter a valid number between 1 and 40 for Platoon ${i + 1}.`);
          return;
        }

        const gridEl = generateGrid(input, hasCommander);
        gridsWrapper.appendChild(gridEl);
      }
    }
  </script>
</body>
</html>
